<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SenaFood | Gestión de Órdenes de Compra</title>
        <!-- Asumiendo que el CSS está en static/css/styles.css -->
    <link rel="stylesheet" href="/css/proveedor/styles.css">
        <!-- Iconos de Font Awesome para los botones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.min.js"></script>
    
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.print.min.js"></script>
</head>
<body>
    <!-- Barra de Navegación -->
    <nav class="navbar">
        <div class="logo">
            <img src="/img/sena_food_logo.png" alt="Logo SenaFood">
            SenaFood
        </div>
        <div>
            <a href="/">Inicio</a>
            <a href="/admin_panel">Dashboard</a>
            <a href="/pqrsf">PQRSF</a>
            <a href="/producto">Producto</a>
            <a href="/proveedores">Proveedores</a>
            <a href="/ordenescompra">Órdenes de Compra</a>
        </div>
        <div class="header-right">
            <div sec:authorize="isAuthenticated()" class="user-profile-menu">
                <span class="user-name" th:text="${#authentication.name}"></span>
                <div class="dropdown-icon">▼</div>
                <div class="dropdown-content">
                    <a href="/perfil/editar" class="dropdown-item">Modificar Datos</a>
                    <form th:action="@{/logout}" method="post" class="logout-form">
                        <button type="submit" class="dropdown-item logout-btn">Cerrar Sesión</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="main-content">
        <h1>Gestión de Órdenes de Compra</h1>

        <!-- Contenedor de Acciones (Crear y Reportes) -->
        <div class="actions-container">
            <a th:href="@{/ordenescompra/form}" class="btn btn-create">
                <i class="fas fa-file-invoice"></i> Crear Nueva Orden de Compra
            </a>
        </div>

        <table id="ordencompraTable" class="data-table"> 
            <thead>
                <tr>
                    <th>ID</th> <th>Fecha</th> <th>Producto</th> <th>Cantidad</th> <th>Precio Unitario</th> <th>Total</th> <th>Estado</th> <th>Proveedor</th> <th>Acciones</th> </tr>
            </thead>
            <tbody>
                <tr th:each="ordencompra : ${listaOrdenesCompra}">
                    <td th:text="${ordencompra.id}"></td>
                    <td th:text="${#temporals.format(ordencompra.fecha, 'dd-MM-yyyy')}"></td>
                    <td th:text="${ordencompra.producto}"></td>
                    <td th:text="${ordencompra.cantidad}"></td>
                    <td th:text="${#numbers.formatCurrency(ordencompra.precioUnitario)}"></td>
                    <td th:text="${#numbers.formatCurrency(ordencompra.total)}"></td>
                    <td th:text="${ordencompra.estado}"></td>
                    <td th:text="${ordencompra.proveedor.nombre}"></td> <td>
                        <a th:href="@{/ordenescompra/form(id=${ordencompra.id})}" class="btn btn-edit">
                            <i class="fas fa-edit"></i> Editar 
                        </a>
                        <a th:href="@{/ordenescompra/delete/{id}(id=${ordencompra.id})}" 
                        class="btn btn-delete"
                        onclick="return confirm('¿Estás seguro de que quieres eliminar la Orden de Compra ID: ' + [[$ordencompra.id]] + '?');">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <footer class="description">
        SenaFood - Gestión Integral de Alimentos | Copyright &copy; 2025
    </footer>

    <script>
        $(document).ready(function() {
            $('#ordencompraTable').DataTable({
                // B: Buttons, f: Filtering/Search, r: Processing, t: Table, i: Info, p: Pagination
                dom: 'Bfrtip', 
                buttons: [
                    // Botón para copiar
                    'copy', 
                    // Exporta a CSV, limitando las columnas a las solicitadas 
                    {
                        extend: 'csvHtml5',
                        text: '<i class="fas fa-file-csv"></i> CSV',
                        // Columnas a exportar (0:ID, 1:Fecha, 2:Producto, 3:Cantidad, 4:Precio Unitario, 5:Total, 6:Estado, 7:Proveedor)
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7] 
                        }
                    },
                    // Exporta a Excel
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7]
                        }
                    },
                    // Exporta a PDF
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6, 7]
                        },
                        // Personalización de PDF (opcional)
                        customize: function(doc) {
                            doc.content[1].table.widths = ['10%', '10%', '25%', '10%', '15%', '15%', '10%', '10%'];
                            doc.styles.tableHeader.fillColor = '#4caf4f';
                        }
                    }
                ],
                // Configuración de idioma (Descomentar si tienes el archivo de idioma)
                /*language: {
                    url: '//cdn.datatables.net/plug-ins/2.0.7/i18n/es-ES.json'
                }*/
            });
        });
    </script>
</body>
</html>